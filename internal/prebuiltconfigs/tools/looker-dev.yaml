# Copyright 2026 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

sources:
    looker-dev-source:
        kind: looker
        base_url: ${LOOKER_BASE_URL}
        client_id: ${LOOKER_CLIENT_ID:}
        client_secret: ${LOOKER_CLIENT_SECRET:}
        verify_ssl: ${LOOKER_VERIFY_SSL:true}
        timeout: 600s
        use_client_oauth: ${LOOKER_USE_CLIENT_OAUTH:false}
        show_hidden_models: ${LOOKER_SHOW_HIDDEN_MODELS:true}
        show_hidden_explores: ${LOOKER_SHOW_HIDDEN_EXPLORES:true}
        show_hidden_fields: ${LOOKER_SHOW_HIDDEN_FIELDS:true}

tools:
    health_pulse:
        kind: looker-health-pulse
        source: looker-dev-source
        description: |
          This tool performs various health checks on a Looker instance.

          Parameters:
          - action (required): Specifies the type of health check to perform.
            Choose one of the following:
            - `check_db_connections`: Verifies database connectivity.
            - `check_dashboard_performance`: Assesses dashboard loading performance.
            - `check_dashboard_errors`: Identifies errors within dashboards.
            - `check_explore_performance`: Evaluates explore query performance.
            - `check_schedule_failures`: Reports on failed scheduled deliveries.
            - `check_legacy_features`: Checks for the usage of legacy features.

          Note on `check_legacy_features`:
          This action is exclusively available in Looker Core instances. If invoked
          on a non-Looker Core instance, it will return a notice rather than an error.
          This notice should be considered normal behavior and not an indication of an issue.

    health_analyze:
        kind: looker-health-analyze
        source: looker-dev-source
        description: |
          This tool calculates the usage statistics for Looker projects, models, and explores.

          Parameters:
          - action (required): The type of resource to analyze. Can be `"projects"`, `"models"`, or `"explores"`.
          - project (optional): The specific project ID to analyze.
          - model (optional): The specific model name to analyze. Requires `project` if used without `explore`.
          - explore (optional): The specific explore name to analyze. Requires `model` if used.
          - timeframe (optional): The lookback period in days for usage data. Defaults to `90` days.
          - min_queries (optional): The minimum number of queries for a resource to be considered active. Defaults to `1`.

          Output:
          The result is a JSON object containing usage metrics for the specified resources.

    health_vacuum:
        kind: looker-health-vacuum
        source: looker-dev-source
        description: |
          This tool identifies and suggests LookML models or explores that can be
          safely removed due to inactivity or low usage.

          Parameters:
          - action (required): The type of resource to analyze for removal candidates. Can be `"models"` or `"explores"`.
          - project (optional): The specific project ID to consider.
          - model (optional): The specific model name to consider. Requires `project` if used without `explore`.
          - explore (optional): The specific explore name to consider. Requires `model` if used.
          - timeframe (optional): The lookback period in days to assess usage. Defaults to `90` days.
          - min_queries (optional): The minimum number of queries for a resource to be considered active. Defaults to `1`.

          Output:
          A JSON array of objects, each representing a model or explore that is a candidate for deletion due to low usage.

    dev_mode:
        kind: looker-dev-mode
        source: looker-dev-source
        description: |
          This tool allows toggling the Looker IDE session between Development Mode and Production Mode.
          Development Mode enables making and testing changes to LookML projects.

          Parameters:
          - enable (required): A boolean value.
            - `true`: Switches the current session to Development Mode.
            - `false`: Switches the current session to Production Mode.

    get_projects:
        kind: looker-get-projects
        source: looker-dev-source
        description: |
          This tool retrieves a list of all LookML projects available on the Looker instance.
          It is useful for identifying projects before performing actions like retrieving
          project files or making modifications.

          Parameters:
          This tool takes no parameters.

          Output:
          A JSON array of objects, each containing the `project_id` and `project_name`
          for a LookML project.

    get_project_files:
        kind: looker-get-project-files
        source: looker-dev-source
        description: |
          This tool retrieves a list of all LookML files within a specified project,
          providing details about each file.

          Parameters:
          - project_id (required): The unique ID of the LookML project, obtained from `get_projects`.

          Output:
          A JSON array of objects, each representing a LookML file and containing
          details such as `path`, `id`, `type`, and `git_status`.

    get_project_file:
        kind: looker-get-project-file
        source: looker-dev-source
        description: |
          This tool retrieves the raw content of a specific LookML file from within a project.

          Parameters:
          - project_id (required): The unique ID of the LookML project, obtained from `get_projects`.
          - file_path (required): The path to the LookML file within the project,
            typically obtained from `get_project_files`.

          Output:
          The raw text content of the specified LookML file.

    create_project_file:
        kind: looker-create-project-file
        source: looker-dev-source
        description: |
          This tool creates a new LookML file within a specified project, populating
          it with the provided content.

          Prerequisite: The Looker session must be in Development Mode. Use `dev_mode: true` first.

          Parameters:
          - project_id (required): The unique ID of the LookML project.
          - file_path (required): The desired path and filename for the new file within the project.
          - content (required): The full LookML content to write into the new file.

          Output:
          A confirmation message upon successful file creation.

    update_project_file:
        kind: looker-update-project-file
        source: looker-dev-source
        description: |
          This tool modifies the content of an existing LookML file within a specified project.

          Prerequisite: The Looker session must be in Development Mode. Use `dev_mode: true` first.

          Parameters:
          - project_id (required): The unique ID of the LookML project.
          - file_path (required): The exact path to the LookML file to modify within the project.
          - content (required): The new, complete LookML content to overwrite the existing file.

          Output:
          A confirmation message upon successful file modification.

    delete_project_file:
        kind: looker-delete-project-file
        source: looker-dev-source
        description: |
          This tool permanently deletes a specified LookML file from within a project.
          Use with caution, as this action cannot be undone through the API.

          Prerequisite: The Looker session must be in Development Mode. Use `dev_mode: true` first.

          Parameters:
          - project_id (required): The unique ID of the LookML project.
          - file_path (required): The exact path to the LookML file to delete within the project.

          Output:
          A confirmation message upon successful file deletion.

    get_project_directories:
        kind: looker-get-project-directories
        source: looker-dev-source
        description: |
          This tool retrieves the list of directories within a specified LookML project.

          Parameters:
          - project_id (required): The unique ID of the LookML project.

          Output:
          A JSON array of strings, where each string is the name of a directory within the project.

    create_project_directory:
        kind: looker-create-project-directory
        source: looker-dev-source
        description: |
          This tool creates a new directory within a specified LookML project.

          Prerequisite: The Looker session must be in Development Mode. Use `dev_mode: true` first.

          Parameters:
          - project_id (required): The unique ID of the LookML project.
          - directory_path (required): The path to the new directory within the project.

          Output:
          A confirmation message upon successful directory creation.

    delete_project_directory:
        kind: looker-delete-project-directory
        source: looker-dev-source
        description: |
          This tool permanently deletes a specified directory within a LookML project.

          Prerequisite: The Looker session must be in Development Mode. Use `dev_mode: true` first.

          Parameters:
          - project_id (required): The unique ID of the LookML project.
          - directory_path (required): The path to the directory within the project.

          Output:
          A confirmation message upon successful directory deletion.

    validate_project:
        kind: looker-validate-project
        source: looker-dev-source
        description: |
          This tool checks a LookML project for syntax errors.

          Prerequisite: The Looker session must be in Development Mode. Use `dev_mode: true` first.

          Parameters:
          - project_id (required): The unique ID of the LookML project.

          Output:
          A list of error details including the file path and line number, and also a list of models
          that are not currently valid due to LookML errors.

    get_connections:
        kind: looker-get-connections
        source: looker-dev-source
        description: |
          This tool retrieves a list of all database connections configured in the Looker system.

          Parameters:
          This tool takes no parameters.

          Output:
          A JSON array of objects, each representing a database connection and including details such as:
          - `name`: The connection's unique identifier.
          - `dialect`: The database dialect (e.g., "mysql", "postgresql", "bigquery").
          - `default_schema`: The default schema for the connection.
          - `database`: The associated database name (if applicable).
          - `supports_multiple_databases`: A boolean indicating if the connection can access multiple databases.

    get_connection_schemas:
        kind: looker-get-connection-schemas
        source: looker-dev-source
        description: |
          This tool retrieves a list of database schemas available through a specified
          Looker connection.

          Parameters:
          - connection_name (required): The name of the database connection, obtained from `get_connections`.
          - database (optional): An optional database name to filter the schemas.
            Only applicable for connections that support multiple databases.

          Output:
          A JSON array of strings, where each string is the name of an available schema.

    get_connection_databases:
        kind: looker-get-connection-databases
        source: looker-dev-source
        description: |
          This tool retrieves a list of databases available through a specified Looker connection.
          This is only applicable for connections that support multiple databases.
          Use `get_connections` to check if a connection supports multiple databases.

          Parameters:
          - connection_name (required): The name of the database connection, obtained from `get_connections`.

          Output:
          A JSON array of strings, where each string is the name of an available database.
          If the connection does not support multiple databases, an empty list or an error will be returned.

    get_connection_tables:
        kind: looker-get-connection-tables
        source: looker-dev-source
        description: |
          This tool retrieves a list of tables available within a specified database schema
          through a Looker connection.

          Parameters:
          - connection_name (required): The name of the database connection, obtained from `get_connections`.
          - schema (required): The name of the schema to list tables from, obtained from `get_connection_schemas`.
          - database (optional): The name of the database to filter by. Only applicable for connections
            that support multiple databases (check with `get_connections`).

          Output:
          A JSON array of strings, where each string is the name of an available table.

    get_connection_table_columns:
        kind: looker-get-connection-table-columns
        source: looker-dev-source
        description: |
          This tool retrieves a list of columns for one or more specified tables within a
          given database schema and connection.

          Parameters:
          - connection_name (required): The name of the database connection, obtained from `get_connections`.
          - schema (required): The name of the schema where the tables reside, obtained from `get_connection_schemas`.
          - tables (required): A comma-separated string of table names for which to retrieve columns
            (e.g., "users,orders,products"), obtained from `get_connection_tables`.
          - database (optional): The name of the database to filter by. Only applicable for connections
            that support multiple databases (check with `get_connections`).

          Output:
          A JSON array of objects, where each object represents a column and contains details
          such as `table_name`, `column_name`, `data_type`, and `is_nullable`.

    get_lookml_tests:
        kind: looker-get-lookml-tests
        source: looker-dev-source
        description: |
          Returns a list of tests which can be run to validate a project's LookML code and/or the underlying data, optionally filtered by the file id.

          Prerequisite: The Looker session must be in Development Mode. Use `dev_mode: true` first.

          Parameters:
          - project_id (required): The unique ID of the LookML project.
          - file_id (optional): The ID of the file to filter tests by. This must be the complete file path from the project root (e.g., `models/my_model.model.lkml` or `views/my_view.view.lkml`).

          Output:
          A JSON array of LookML test objects, each containing:
          - model_name: The name of the model.
          - name: The name of the test.
          - explore_name: The name of the explore being tested.
          - query_url_params: The query parameters used for the test.
          - file: The file path where the test is defined.
          - line: The line number where the test is defined.

    run_lookml_tests:
        kind: looker-run-lookml-tests
        source: looker-dev-source
        description: |
          This tool runs LookML tests in the project, filtered by file, test, and/or model. These filters work in conjunction (logical AND).

          Prerequisite: The Looker session must be in Development Mode. Use `dev_mode: true` first.

          Parameters:
          - project_id (required): The unique ID of the project to run LookML tests for.
          - file_id (optional): The ID of the file to run tests for. This must be the complete file path from the project root (e.g., `models/my_model.model.lkml` or `views/my_view.view.lkml`).
          - test (optional): The name of the test to run.
          - model (optional): The name of the model to run tests for.

          Output:
          A JSON array containing the results of the executed tests, where each object includes:
          - model_name: Name of the model tested.
          - test_name: Name of the test.
          - assertions_count: Total number of assertions in the test.
          - assertions_failed: Number of assertions that failed.
          - success: Boolean indicating if the test passed.
          - errors: Array of error objects (if any), containing details like `message`, `file_path`, `line_number`, and `severity`.
          - warnings: Array of warning messages (if any).

    create_view_from_table:
        kind: looker-create-view-from-table
        source: looker-dev-source
        description: |
          This tool generates boilerplate LookML views directly from the database schema.
          It does not create model or explore files, only view files in the specified folder.

          Prerequisite: The Looker session must be in Development Mode. Use `dev_mode: true` first.

          Parameters:
          - project_id (required): The unique ID of the LookML project.
          - connection (required): The database connection name.
          - tables (required): A list of objects to generate views for. Each object must contain `schema` and `table_name` (note: table names are case-sensitive). Optional fields include `primary_key`, `base_view`, and `columns` (array of objects with `column_name`).
          - folder_name (optional): The folder to place the view files in (defaults to 'views/').

          Output:
          A confirmation message upon successful view generation, or an error message if the operation fails.

toolsets:
    looker_dev_tools:
        - health_pulse
        - health_analyze
        - health_vacuum
        - dev_mode
        - get_projects
        - get_project_files
        - get_project_file
        - create_project_file
        - update_project_file
        - delete_project_file
        - get_project_directories
        - create_project_directory
        - delete_project_directory
        - validate_project
        - get_connections
        - get_connection_schemas
        - get_connection_databases
        - get_connection_tables
        - get_connection_table_columns
        - get_lookml_tests
        - run_lookml_tests
        - create_view_from_table
